<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS-ID - Estructura de Módulos</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;400;700;800&display=swap');

        :root {
            --bg-deep: #050608;
            --accent-cyan: #00f2ff;
            --accent-purple: #bc13fe;
            --glass-bg: rgba(10, 15, 25, 0.7);
            --glass-border: rgba(0, 242, 255, 0.2);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: radial-gradient(circle at center, #0f172a 0%, #050608 100%);
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Efecto de Vidrio Esmerilado Premium */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
        }

        /* Estilo de Botones Circulares de la Imagen */
        .nav-icon-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(0, 242, 255, 0.3);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: rgba(0, 242, 255, 0.05);
        }

        .nav-icon-btn:hover {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 20px var(--accent-cyan);
            transform: scale(1.1);
        }

        /* Tarjetas de Estadísticas de Colores */
        .stat-card {
            padding: 1.5rem;
            border-radius: 1rem;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-purple { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
        .stat-green { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .stat-orange { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .stat-red { background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%); }

        /* QR Modal High-Tech */
        #qr-modal .glass-card {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--accent-cyan);
            box-shadow: 0 0 50px rgba(0, 242, 255, 0.2);
        }

        /* Líneas de Conexión (Decorativas) */
        .connect-line {
            position: absolute;
            background: linear-gradient(90deg, transparent, var(--accent-cyan), transparent);
            height: 1px;
            opacity: 0.3;
        }

        canvas {
            border: 4px solid white;
            border-radius: 10px;
            background: white !important;
        }

        .admin-only { display: none; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="login-screen" class="fixed inset-0 z-[5000] flex items-center justify-center bg-black/80 backdrop-blur-xl">
        <div class="glass-panel p-10 w-full max-w-md border-t-4 border-t-[#00f2ff]">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-extrabold tracking-widest text-white italic">NEXUS-ID</h2>
                <div class="h-1 w-20 bg-cyan-400 mx-auto mt-2"></div>
            </div>
            <form id="login-form" class="space-y-6">
                <input type="email" id="user-input" placeholder="ACCESS_EMAIL" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none focus:border-cyan-400 transition-all text-white font-mono uppercase text-xs" required>
                <input type="password" id="pass-input" placeholder="SECURITY_KEY" class="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none focus:border-cyan-400 transition-all text-white font-mono uppercase text-xs" required>
                <button type="submit" class="w-full bg-cyan-500 hover:bg-cyan-400 text-black font-black p-4 rounded-xl transition-all shadow-[0_0_15px_rgba(0,242,255,0.4)] uppercase text-sm tracking-widest">Inyectar Credenciales</button>
            </form>
        </div>
    </div>

    <div id="app-interface" class="hidden max-w-[1400px] mx-auto relative">
        
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 px-4">
            <div>
                <h1 class="text-3xl font-black tracking-tighter text-white">ESTRUCTURA DE MÓDULOS <span class="text-cyan-400 text-sm font-normal ml-2 tracking-widest uppercase">Vista Explosiva</span></h1>
                <p id="current-time" class="text-xs font-mono text-cyan-500/80 mt-1"></p>
            </div>
            <div class="flex items-center gap-4 mt-4 md:mt-0 glass-panel px-6 py-2">
                <div class="text-right">
                    <p id="display-user" class="text-xs font-bold text-white uppercase tracking-tighter"></p>
                    <button onclick="logout()" class="text-[10px] text-red-400 hover:text-red-300 font-black uppercase">Desconectar</button>
                </div>
                <div class="w-10 h-10 rounded-full border-2 border-cyan-400 p-1">
                    <img src="https://raw.githubusercontent.com/anniel137/uptjaa-inventory/main/gemini-2.5-flash-image_quiero_que_me_crees_el_logo_de_el_polianzoategui_que_sea_algo_mas_futurista-0.jpg" class="rounded-full">
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <aside class="lg:col-span-1 flex lg:flex-col items-center justify-around lg:justify-start gap-8 lg:pt-10">
                <button onclick="showSection('dashboard')" class="nav-icon-btn" title="Dashboard">
                    <i class="fas fa-th-large text-cyan-400"></i>
                </button>
                <button onclick="showSection('inventario')" class="nav-icon-btn" title="Inventario">
                    <i class="fas fa-archive text-purple-400"></i>
                </button>
                <button onclick="showSection('reportes')" class="nav-icon-btn admin-only" title="Reportes">
                    <i class="fas fa-broadcast-tower text-green-400"></i>
                </button>
                <button onclick="showSection('usuarios')" class="nav-icon-btn admin-only" title="Usuarios">
                    <i class="fas fa-user-shield text-orange-400"></i>
                </button>
            </aside>

            <main class="lg:col-span-11">
                
                <section id="sec-dashboard">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                        <div class="stat-card stat-purple">
                            <p class="text-[10px] font-bold uppercase mb-1">Total Activos</p>
                            <p id="dash-total" class="text-4xl font-black">0</p>
                        </div>
                        <div class="stat-card stat-green">
                            <p class="text-[10px] font-bold uppercase mb-1">Excelente</p>
                            <p id="dash-excelente" class="text-4xl font-black">0</p>
                        </div>
                        <div class="stat-card stat-orange">
                            <p class="text-[10px] font-bold uppercase mb-1">Mantenimiento</p>
                            <p id="dash-mantenimiento" class="text-4xl font-black">0</p>
                        </div>
                        <div class="stat-card stat-red">
                            <p class="text-[10px] font-bold uppercase mb-1">Dañados</p>
                            <p id="dash-danado" class="text-4xl font-black">0</p>
                        </div>
                    </div>

                    <div class="glass-panel p-8">
                        <h2 class="text-sm font-black text-cyan-400 uppercase tracking-[0.3em] mb-6">Módulos de Red Activos</h2>
                        <div id="assets-container" class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-6">
                            </div>
                    </div>
                </section>

                <section id="sec-inventario" class="hidden space-y-6">
                    <div class="glass-panel p-8 admin-only">
                        <h3 id="asset-form-title" class="text-xl font-black mb-6 text-white uppercase italic">Registrar Nodo</h3>
                        <form id="form-asset" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="hidden" id="edit-id">
                            <input type="text" id="as-name" placeholder="NOMBRE_EQUIPO" class="bg-white/5 p-4 rounded-xl border border-white/10 outline-none focus:border-cyan-400 text-white font-mono text-xs">
                            <input type="text" id="as-serial" placeholder="N_SERIAL" class="bg-white/5 p-4 rounded-xl border border-white/10 outline-none focus:border-cyan-400 text-white font-mono text-xs">
                            <input type="text" id="as-ip" placeholder="IP_DIRECCIÓN" class="bg-white/5 p-4 rounded-xl border border-white/10 outline-none focus:border-cyan-400 text-white font-mono text-xs">
                            <input type="text" id="as-loc" placeholder="UBICACIÓN_FÍSICA" class="bg-white/5 p-4 rounded-xl border border-white/10 outline-none focus:border-cyan-400 text-white font-mono text-xs">
                            <input type="url" id="as-photo" placeholder="URL_NODO_IMAGE" class="bg-white/5 p-4 rounded-xl border border-white/10 outline-none focus:border-cyan-400 text-white font-mono text-xs">
                            <select id="as-cond" class="bg-cyan-600 p-4 rounded-xl font-black uppercase text-xs text-black">
                                <option value="Excelente">Estado: Excelente</option>
                                <option value="Mantenimiento">Estado: Mantenimiento</option>
                                <option value="Dañado">Estado: Dañado</option>
                            </select>
                            <div class="col-span-full">
                                <button type="submit" id="btn-asset-submit" class="w-full bg-white text-black font-black p-4 rounded-xl hover:bg-cyan-400 transition-all uppercase tracking-widest text-xs">Ejecutar Registro</button>
                            </div>
                        </form>
                    </div>
                </section>

                <section id="sec-usuarios" class="hidden">
                    <div class="glass-panel p-8">
                        <h3 class="text-xl font-black mb-6 text-orange-400 uppercase tracking-widest">Protocolo de Usuarios</h3>
                        <form id="form-user" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-10">
                            <input type="email" id="new-u-email" placeholder="EMAIL" class="bg-white/5 p-4 rounded-xl border border-white/10 text-white font-mono text-[10px]">
                            <input type="password" id="new-u-pass" placeholder="PASSWORD" class="bg-white/5 p-4 rounded-xl border border-white/10 text-white font-mono text-[10px]">
                            <input type="text" id="new-u-name" placeholder="IDENTIDAD" class="bg-white/5 p-4 rounded-xl border border-white/10 text-white font-mono text-[10px]">
                            <select id="new-u-role" class="bg-orange-600 p-4 rounded-xl font-black text-[10px] text-black uppercase">
                                <option value="admin">ADMIN_ROOT</option>
                                <option value="operador">OPERADOR_USER</option>
                            </select>
                            <button type="submit" class="col-span-full bg-white text-black font-black p-3 rounded-xl uppercase text-[10px]">Generar Acceso</button>
                        </form>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <div id="qr-modal" class="fixed inset-0 z-[6000] bg-black/90 backdrop-blur-md flex items-center justify-center hidden">
        <div class="glass-panel p-10 max-w-sm w-full text-center border-2 border-cyan-400">
            <h3 class="text-cyan-400 font-black uppercase tracking-widest mb-6">Módulo QR</h3>
            <div id="print-area" class="flex flex-col items-center">
                <div id="qr-large" class="mb-4"></div>
                <p id="qr-modal-name" class="text-white font-bold text-sm uppercase"></p>
                <p id="qr-modal-id" class="text-cyan-400/50 text-[8px] font-mono mt-2"></p>
            </div>
            <div class="flex gap-4 mt-8 no-print">
                <button onclick="window.print()" class="flex-1 bg-cyan-500 text-black font-black py-3 rounded-lg text-[10px] uppercase">Imprimir</button>
                <button onclick="closeQrModal()" class="flex-1 border border-white/20 text-white font-black py-3 rounded-lg text-[10px] uppercase">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        // --- LÓGICA DE FIREBASE (MANTENIDA) ---
        const firebaseConfig = {
            apiKey: "AIzaSyD0rFUIbW_494SmefO7FRVhsBVW1aXxcDo",
            authDomain: "control-de-activos-1c3b7.firebaseapp.com",
            databaseURL: "https://control-de-activos-1c3b7-default-rtdb.firebaseio.com",
            projectId: "control-de-activos-1c3b7",
            storageBucket: "control-de-activos-1c3b7.firebasestorage.app",
            messagingSenderId: "898905793270",
            appId: "1:898905793270:web:7e8e1219f999af6a88c2d7"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(); const db = firebase.database();
        let currentRole = 'operador';
        let BASE_URL = window.location.origin + window.location.pathname.replace('index.html', '');

        auth.onAuthStateChanged(user => {
            if (user) handleSuccessfulLogin(user);
        });

        function handleSuccessfulLogin(user) {
            db.ref('users').orderByChild('email').equalTo(user.email).once('value', snap => {
                let userData = null; snap.forEach(c => userData = c.val());
                currentRole = userData?.role || 'operador';
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('app-interface').classList.remove('hidden');
                document.getElementById('display-user').textContent = userData?.name || user.email;
                if (currentRole === 'admin') document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
                loadAssets();
            });
        }

        function loadAssets() {
            db.ref('assets').on('value', snap => {
                const container = document.getElementById('assets-container');
                container.innerHTML = '';
                let stats = { total: 0, Excelente: 0, Mantenimiento: 0, Dañado: 0 };
                
                snap.forEach(doc => {
                    const a = doc.val();
                    stats.total++; stats[a.cond]++;
                    const card = document.createElement('div');
                    card.className = "glass-panel p-4 flex flex-col items-center hover:border-cyan-400 transition-all cursor-pointer";
                    card.onclick = () => openQrModal(doc.key, a.name);
                    card.innerHTML = `
                        <img src="${a.imageUrl}" class="w-full h-24 rounded-lg object-cover mb-3 opacity-80">
                        <h3 class="text-[10px] font-black uppercase text-white tracking-tighter">${a.name}</h3>
                        <p class="text-[8px] text-cyan-400 font-mono">${a.location}</p>
                    `;
                    container.appendChild(card);
                });
                ['total','excelente','mantenimiento','danado'].forEach(id => {
                    const el = document.getElementById('dash-'+id);
                    if(el) el.textContent = stats[id.charAt(0).toUpperCase() + id.slice(1)] || stats[id] || 0;
                });
            });
        }

        document.getElementById('login-form').onsubmit = (e) => {
            e.preventDefault();
            auth.signInWithEmailAndPassword(document.getElementById('user-input').value, document.getElementById('pass-input').value)
                .catch(() => alert('ACCESO DENEGADO: Credenciales Invalidas'));
        };

        function openQrModal(id, name) {
            document.getElementById('qr-modal').classList.remove('hidden');
            document.getElementById('qr-modal-name').textContent = name;
            document.getElementById('qr-modal-id').textContent = "NODE_ID: " + id;
            document.getElementById('qr-large').innerHTML = '';
            new QRCode(document.getElementById('qr-large'), { text: BASE_URL + "?id=" + id, width: 200, height: 200 });
        }

        function closeQrModal() { document.getElementById('qr-modal').classList.add('hidden'); }
        function logout() { auth.signOut().then(() => location.reload()); }
        function showSection(id) { 
            document.querySelectorAll('main section').forEach(s => s.classList.add('hidden')); 
            document.getElementById('sec-' + id).classList.remove('hidden');
        }
        setInterval(() => { document.getElementById('current-time').textContent = new Date().toLocaleString() + " - UPTJAA_OS"; }, 1000);
    </script>
</body>
</html>
