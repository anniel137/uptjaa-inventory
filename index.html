<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS-ID - Sistema Integrado de Activos Tecnológicos</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        :root { --bg-dark: #0a0b10; --glass: rgba(255, 255, 255, 0.05); --neon-purple: #bc13fe; --neon-cyan: #00f2ff; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: radial-gradient(circle at top right, #1a1b25, #0a0b10); color: white; min-height: 100vh; margin: 0; }
        .glass-card { background: var(--glass); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 2rem; }
        .btn-primary { background: linear-gradient(90deg, #bc13fe, #7a12f5); transition: all 0.3s ease; }
        .input-dark { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 1rem; border-radius: 1rem; outline: none; }
        .input-dark:focus { border-color: var(--neon-cyan); }

        /* ESTILOS DE IMPRESIÓN AGREGADOS */
        @media print {
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                display: flex !important; 
                flex-direction: column;
                justify-content: center; 
                align-items: center; 
                background: white !important;
            }
            .no-print { display: none !important; }
            #qr-gen { border: none !important; }
            #qr-label { color: black !important; font-size: 14pt !important; margin-top: 10px; }
        }
    </style>
</head>
<body>

    <!-- VISTA PÚBLICA PARA QR (sin login) -->
    <div id="public-scan-screen" class="hidden fixed inset-0 z-[2500] bg-[#0a0b10] overflow-y-auto p-6">
        <div class="max-w-lg mx-auto pt-6">
            <div class="flex items-center gap-3 mb-6">
                <img src="https://raw.githubusercontent.com/anniel137/uptjaa-inventory/main/gemini-2.5-flash-image_quiero_que_me_crees_el_logo_de_el_polianzoategui_que_sea_algo_mas_futurista-0.jpg" class="w-10 h-10 rounded-full border border-cyan-400 object-cover">
                <div>
                    <h1 class="font-black text-xl italic">NEXUS-ID</h1>
                    <p class="text-[8px] font-bold text-cyan-400 uppercase tracking-widest">Sistema Integrado de Activos Tecnológicos</p>
                </div>
            </div>
            <div id="public-loading" class="glass-card p-10 text-center">
                <i class="fas fa-spinner fa-spin text-4xl text-cyan-400 mb-4"></i>
                <p class="text-slate-400 font-bold uppercase text-sm">Cargando información del activo...</p>
            </div>
            <div id="public-asset-card" class="hidden glass-card overflow-hidden">
                <img id="pub-img" class="w-full h-56 object-cover">
                <div class="p-6 space-y-4">
                    <h2 id="pub-name" class="text-3xl font-black uppercase italic text-cyan-400"></h2>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-white/5 p-4 rounded-2xl">
                            <p class="text-[9px] text-slate-500 uppercase mb-1">Estado</p>
                            <p id="pub-cond" class="font-black text-sm"></p>
                        </div>
                        <div class="bg-white/5 p-4 rounded-2xl">
                            <p class="text-[9px] text-slate-500 uppercase mb-1">Ubicación</p>
                            <p id="pub-loc" class="font-black text-sm"></p>
                        </div>
                        <div class="bg-white/5 p-4 rounded-2xl">
                            <p class="text-[9px] text-slate-500 uppercase mb-1">Serial</p>
                            <p id="pub-serial" class="font-black text-sm"></p>
                        </div>
                    </div>
                    <div id="pub-reason-box" class="hidden bg-orange-500/10 border border-orange-500/30 p-4 rounded-2xl">
                        <p class="text-[9px] text-orange-400 uppercase font-black mb-1">Nota de estado</p>
                        <p id="pub-reason-text" class="text-sm italic text-slate-300"></p>
                    </div>
                    <div class="pt-2 border-t border-white/10 text-center">
                        <p class="text-[9px] text-slate-500 uppercase">Para reportar una novedad, inicie sesión como operario</p>
                        <button onclick="document.getElementById('public-scan-screen').classList.add('hidden'); document.getElementById('login-screen').classList.remove('hidden');" 
                            class="mt-2 btn-primary px-6 py-2 rounded-xl font-black uppercase text-xs">
                            <i class="fas fa-sign-in-alt mr-1"></i> Iniciar Sesión
                        </button>
                    </div>
                </div>
            </div>
            <div id="public-not-found" class="hidden glass-card p-10 text-center">
                <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                <p class="font-black uppercase text-sm text-red-400">Activo no encontrado</p>
                <p class="text-xs text-slate-500 mt-2">El código QR puede estar desactualizado o el activo fue eliminado.</p>
            </div>
        </div>
    </div>

    <div id="login-screen" class="fixed inset-0 z-[2000] bg-[#0a0b10] flex items-center justify-center p-6">
        <div class="glass-card p-10 w-full max-w-md text-center">
            <img src="https://raw.githubusercontent.com/anniel137/uptjaa-inventory/main/gemini-2.5-flash-image_quiero_que_me_crees_el_logo_de_el_polianzoategui_que_sea_algo_mas_futurista-0.jpg" class="w-24 h-24 mx-auto mb-6 rounded-full border-2 border-cyan-400 object-cover">
            <h2 class="text-4xl font-black italic mb-1">NEXUS-ID</h2>
            <p class="text-[9px] text-cyan-400 font-bold mb-8 uppercase tracking-widest">Sistema Integrado de Activos Tecnológicos</p>
            <form id="login-form" class="space-y-4">
                <input type="email" id="user-input" placeholder="Correo Administrativo" class="w-full input-dark" required>
                <input type="password" id="pass-input" placeholder="Contraseña" class="w-full input-dark" required>
                <button type="submit" class="w-full btn-primary p-4 rounded-2xl font-black uppercase text-sm shadow-lg hover:scale-105 transition">Entrar al Sistema</button>
            </form>
        </div>
    </div>

    <div id="app-interface" class="hidden flex h-screen w-full">
        <aside id="main-sidebar" class="w-72 bg-black/40 backdrop-blur-xl border-r border-white/10 flex flex-col p-6 shrink-0">
            <div class="mb-12">
                <h1 class="font-black text-3xl italic">NEXUS-ID</h1>
                <p class="text-[8px] font-bold text-purple-500 uppercase mt-1">Sistema Integrado de Activos Tecnológicos</p>
            </div>
            <nav class="flex-1 space-y-3">
                <button onclick="showSection('dashboard')" class="w-full flex items-center p-4 rounded-2xl font-bold text-slate-400 hover:text-cyan-400"><i class="fas fa-chart-line w-8"></i> Panel</button>
                <button onclick="showSection('inventario')" class="w-full flex items-center p-4 rounded-2xl font-bold text-slate-400 hover:text-cyan-400"><i class="fas fa-box-open w-8"></i> Inventario</button>
                <button onclick="showSection('reportes')" class="w-full flex items-center p-4 rounded-2xl font-bold text-slate-400 hover:text-cyan-400"><i class="fas fa-bell w-8"></i> Reportes</button>
                <button onclick="showSection('usuarios')" class="w-full flex items-center p-4 rounded-2xl font-bold text-slate-400 hover:text-cyan-400"><i class="fas fa-users-cog w-8"></i> Usuarios</button>
            </nav>
            <div class="p-4 glass-card rounded-2xl text-center">
                <p id="user-role-badge" class="text-[8px] font-black text-cyan-400 uppercase mb-1"></p>
                <p id="display-user" class="text-[10px] text-white truncate"></p>
                <button onclick="logout()" class="text-[9px] text-red-500 font-black mt-2 uppercase">Salir</button>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto">
            <header class="p-8">
                <h2 id="section-title" class="text-3xl font-black uppercase italic text-white">Dashboard</h2>
            </header>

            <div id="content-area" class="p-8">
                
                <section id="sec-dashboard" class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="glass-card p-8 border-l-4 border-purple-500"><h4>Total Activos</h4><p id="dash-total" class="text-4xl font-black">0</p></div>
                    <div class="glass-card p-8 border-l-4 border-emerald-500"><h4>Excelente</h4><p id="dash-excelente" class="text-4xl font-black">0</p></div>
                    <div class="glass-card p-8 border-l-4 border-orange-500"><h4>Mantenimiento</h4><p id="dash-mantenimiento" class="text-4xl font-black">0</p></div>
                    <div class="glass-card p-8 border-l-4 border-red-500"><h4>Dañado</h4><p id="dash-danado" class="text-4xl font-black">0</p></div>
                </section>

                <section id="sec-inventario" class="hidden space-y-8">
                    <div class="glass-card p-8">
                        <h3 id="asset-form-title" class="text-xl font-black mb-6 uppercase">Gestión de Activo</h3>
                        <form id="form-asset" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="hidden" id="edit-id">
                            <input type="text" id="as-name" placeholder="Nombre" class="input-dark" required>
                            <input type="text" id="as-serial" placeholder="Serial" class="input-dark" required>
                            <input type="text" id="as-loc" placeholder="Ubicación" class="input-dark" required>
                            <input type="url" id="as-photo" placeholder="Imagen (URL)" class="input-dark" required>
                            <select id="as-cond" class="input-dark bg-slate-800">
                                <option value="Excelente">Excelente</option>
                                <option value="Mantenimiento">Mantenimiento</option>
                                <option value="Dañado">Dañado</option>
                            </select>
                            <textarea id="as-reason" placeholder="Detalle del estado del activo..." class="input-dark h-24"></textarea>
                            <button type="submit" class="col-span-full btn-primary p-4 rounded-xl font-black uppercase">Sincronizar Activo</button>
                        </form>
                    </div>
                    <div id="assets-container" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>
                </section>

                <section id="sec-usuarios" class="hidden space-y-8">
                    <div class="glass-card p-8">
                        <h3 class="text-xl font-black mb-6 uppercase">Registrar Nuevo Personal</h3>
                        <form id="form-user" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="text" id="u-name" placeholder="Nombre" class="input-dark" required>
                            <input type="email" id="u-email" placeholder="Correo" class="input-dark" required>
                            <select id="u-role" class="input-dark bg-slate-800">
                                <option value="operario">Operador</option>
                                <option value="admin">Administrador</option>
                            </select>
                            <button type="submit" class="col-span-full btn-primary p-4 rounded-xl font-black uppercase">Añadir al Sistema</button>
                        </form>
                    </div>
                    <div id="admin-user-list" class="hidden glass-card p-8">
                        <h3 class="text-xl font-black mb-6 uppercase">Panel Administrativo de Usuarios</h3>
                        <div id="users-table-container" class="overflow-x-auto text-sm"></div>
                    </div>
                </section>

                <section id="sec-reportes" class="hidden space-y-4">
                    <div id="reports-list-container"></div>
                </section>

                <section id="sec-scan-view" class="hidden max-w-2xl mx-auto">
                    <div class="glass-card overflow-hidden">
                        <img id="scan-img" class="w-full h-72 object-cover">
                        <div class="p-8 space-y-6">
                            <h2 id="scan-name" class="text-4xl font-black uppercase italic text-cyan-400"></h2>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-white/5 p-4 rounded-2xl"><p class="text-[9px] text-slate-500 uppercase">Estado</p><p id="scan-cond" class="font-black"></p></div>
                                <div class="bg-white/5 p-4 rounded-2xl"><p class="text-[9px] text-slate-500 uppercase">Ubicación</p><p id="scan-loc" class="font-black"></p></div>
                            </div>
                            <div id="scan-reason-box" class="bg-red-500/10 border border-red-500/20 p-4 rounded-2xl hidden">
                                <p id="scan-reason-text" class="text-sm italic"></p>
                            </div>
                            <hr class="border-white/10">
                            <div class="space-y-4">
                                <h3 class="font-black text-xs uppercase text-center">Actualizar Novedad</h3>
                                <select id="rep-new-cond" class="w-full input-dark bg-slate-800">
                                    <option value="Dañado">Dañado</option>
                                    <option value="Mantenimiento">Mantenimiento</option>
                                    <option value="Excelente">Excelente</option>
                                </select>
                                <textarea id="rep-reason" placeholder="Explicación detallada..." class="w-full input-dark h-24" required></textarea>
                                <button id="btn-send-report" class="w-full btn-primary p-4 rounded-2xl font-black uppercase">Guardar Reporte</button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD0rFUIbW_494SmefO7FRVhsBVW1aXxcDo",
            authDomain: "control-de-activos-1c3b7.firebaseapp.com",
            databaseURL: "https://control-de-activos-1c3b7-default-rtdb.firebaseio.com",
            projectId: "control-de-activos-1c3b7",
            storageBucket: "control-de-activos-1c3b7.firebasestorage.app",
            messagingSenderId: "898905793270",
            appId: "1:898905793270:web:7e8e1219f999af6a88c2d7"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(); const db = firebase.database();
        const MASTER_EMAIL = "anniel137@gmail.com";
        let userRole = "operario";

        const urlParams = new URLSearchParams(window.location.search);
        const scannedId = urlParams.get('id');

        // Si hay un ID en la URL (escaneo QR), mostrar vista pública SIN requerir login
        if (scannedId) {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('public-scan-screen').classList.remove('hidden');
            loadPublicAsset(scannedId);
        }

        function loadPublicAsset(id) {
            db.ref('assets/' + id).once('value', snap => {
                document.getElementById('public-loading').classList.add('hidden');
                const a = snap.val();
                if (!a) {
                    document.getElementById('public-not-found').classList.remove('hidden');
                    return;
                }
                const card = document.getElementById('public-asset-card');
                card.classList.remove('hidden');
                document.getElementById('pub-img').src = a.imageUrl;
                document.getElementById('pub-name').textContent = a.name;
                document.getElementById('pub-serial').textContent = a.serial || 'N/A';
                const condEl = document.getElementById('pub-cond');
                condEl.textContent = a.cond;
                condEl.className = 'font-black text-sm ' + (a.cond === 'Dañado' ? 'text-red-400' : a.cond === 'Mantenimiento' ? 'text-orange-400' : 'text-emerald-400');
                document.getElementById('pub-loc').textContent = a.location;
                if (a.reason) {
                    document.getElementById('pub-reason-box').classList.remove('hidden');
                    document.getElementById('pub-reason-text').textContent = a.reason;
                }
            });
        }

        auth.onAuthStateChanged(user => {
            if (user) {
                db.ref('users/' + user.uid).on('value', snap => {
                    let userData = snap.val();
                    if (user.email === MASTER_EMAIL && !userData) {
                        userData = { name: "Admin General", role: "admin", email: user.email };
                        db.ref('users/' + user.uid).set(userData);
                    }
                    userRole = userData?.role || "operario";
                    
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('public-scan-screen').classList.add('hidden');
                    document.getElementById('app-interface').classList.remove('hidden');
                    document.getElementById('display-user').textContent = user.email;
                    document.getElementById('user-role-badge').textContent = userRole;

                    if (userRole === 'admin') {
                        document.getElementById('admin-user-list').classList.remove('hidden');
                        loadAdminUsers();
                    }

                    if(scannedId) {
                        document.getElementById('main-sidebar').classList.add('hidden');
                        loadScannedAsset(scannedId);
                    } else {
                        showSection('dashboard');
                        loadAssets();
                        loadReports();
                    }
                });
            } else {
                if (!scannedId) {
                    document.getElementById('login-screen').classList.remove('hidden');
                    document.getElementById('app-interface').classList.add('hidden');
                }
            }
        });

        function loadAssets() {
            db.ref('assets').on('value', snap => {
                const container = document.getElementById('assets-container');
                container.innerHTML = '';
                let stats = { total: 0, Excelente: 0, Mantenimiento: 0, Dañado: 0 };
                snap.forEach(doc => {
                    const a = doc.val(); stats.total++; stats[a.cond]++;
                    container.innerHTML += `
                        <div class="glass-card p-6 border border-white/5">
                            <img src="${a.imageUrl}" class="w-full h-32 object-cover rounded-xl mb-4">
                            <h4 class="text-white font-black uppercase text-xs">${a.name}</h4>
                            <p class="text-[9px] font-bold ${a.cond === 'Dañado' ? 'text-red-500' : 'text-cyan-400'} uppercase">${a.cond}</p>
                            <div class="flex gap-2 mt-4">
                                <button onclick="editAsset('${doc.key}')" class="flex-1 bg-white/5 p-2 rounded-lg text-[9px] font-bold">EDITAR</button>
                                <button onclick="openQR('${doc.key}')" class="flex-1 bg-white/5 p-2 rounded-lg text-[9px] font-bold">QR</button>
                                <button onclick="deleteAsset('${doc.key}')" class="p-2 text-red-500/50 hover:text-red-500"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>`;
                });
                document.getElementById('dash-total').textContent = stats.total;
                document.getElementById('dash-excelente').textContent = stats.Excelente;
                document.getElementById('dash-mantenimiento').textContent = stats.Mantenimiento;
                document.getElementById('dash-danado').textContent = stats.Dañado;
            });
        }

        document.getElementById('form-user').onsubmit = (e) => {
            e.preventDefault();
            const data = {
                name: document.getElementById('u-name').value,
                email: document.getElementById('u-email').value,
                role: document.getElementById('u-role').value
            };
            db.ref('users').push(data).then(() => { alert("Personal Añadido"); e.target.reset(); });
        };

        function loadAdminUsers() {
            db.ref('users').on('value', snap => {
                const container = document.getElementById('users-table-container');
                let html = `<table class="w-full text-left uppercase text-[11px] font-bold">
                    <tr class="text-slate-500 border-b border-white/10"><th class="p-4">Nombre / Email</th><th class="p-4">Rol</th><th class="p-4">Acción</th></tr>`;
                snap.forEach(doc => {
                    const u = doc.val();
                    html += `<tr class="border-b border-white/5">
                        <td class="p-4">${u.name}<br><span class="text-[9px] text-slate-500">${u.email}</span></td>
                        <td class="p-4">${u.role}</td>
                        <td class="p-4">
                            ${u.email !== MASTER_EMAIL ? `<button onclick="deleteUser('${doc.key}')" class="text-red-500"><i class="fas fa-trash-alt"></i></button>` : '-'}
                        </td>
                    </tr>`;
                });
                container.innerHTML = html + "</table>";
            });
        }

        function showSection(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('sec-' + id).classList.remove('hidden');
            document.getElementById('section-title').textContent = id.toUpperCase();
        }

        document.getElementById('form-asset').onsubmit = (e) => {
            e.preventDefault();
            const id = document.getElementById('edit-id').value;
            const data = {
                name: document.getElementById('as-name').value,
                serial: document.getElementById('as-serial').value,
                location: document.getElementById('as-loc').value,
                imageUrl: document.getElementById('as-photo').value,
                cond: document.getElementById('as-cond').value,
                reason: document.getElementById('as-reason').value
            };
            if(id) db.ref('assets/' + id).update(data).then(() => { alert("Actualizado"); e.target.reset(); document.getElementById('edit-id').value=""; });
            else db.ref('assets').push(data).then(() => { alert("Guardado"); e.target.reset(); });
        };

        function editAsset(id) {
            db.ref('assets/' + id).once('value', snap => {
                const a = snap.val();
                document.getElementById('edit-id').value = id;
                document.getElementById('as-name').value = a.name;
                document.getElementById('as-serial').value = a.serial;
                document.getElementById('as-loc').value = a.location;
                document.getElementById('as-photo').value = a.imageUrl;
                document.getElementById('as-cond').value = a.cond;
                document.getElementById('as-reason').value = a.reason || "";
                showSection('inventario');
            });
        }

        function loadScannedAsset(id) {
            db.ref('assets/' + id).on('value', snap => {
                const a = snap.val(); if(!a) return;
                showSection('scan-view');
                document.getElementById('scan-img').src = a.imageUrl;
                document.getElementById('scan-name').textContent = a.name;
                document.getElementById('scan-cond').textContent = a.cond;
                document.getElementById('scan-loc').textContent = a.location;
                if(a.reason) {
                    document.getElementById('scan-reason-box').classList.remove('hidden');
                    document.getElementById('scan-reason-text').textContent = "NOTA ACTUAL: " + a.reason;
                }
                document.getElementById('btn-send-report').onclick = () => {
                    const motivo = document.getElementById('rep-reason').value;
                    const newC = document.getElementById('rep-new-cond').value;
                    if(!motivo) return alert("Indique el motivo de la novedad");
                    db.ref('reports').push({ assetName: a.name, user: auth.currentUser.email, reason: motivo, newC: newC, date: new Date().toLocaleString() });
                    db.ref('assets/' + id).update({ cond: newC, reason: motivo }).then(() => alert("Estado Actualizado con Éxito"));
                };
            });
        }

        function loadReports() {
            db.ref('reports').on('value', snap => {
                const container = document.getElementById('reports-list-container');
                container.innerHTML = '<h3 class="text-xl font-black mb-6 italic uppercase">Historial de Actividad</h3>';
                snap.forEach(doc => {
                    const r = doc.val();
                    container.innerHTML = `
                        <div class="glass-card p-5 border-l-4 ${r.newC === 'Dañado' ? 'border-red-500' : 'border-orange-500'} mb-3">
                            <p class="text-[9px] text-slate-500">${r.date} - Por: ${r.user}</p>
                            <h5 class="text-white font-black uppercase">${r.assetName}</h5>
                            <p class="text-xs text-cyan-400 font-black">ESTADO ACTUALIZADO A: ${r.newC}</p>
                            <p class="mt-2 text-sm italic text-slate-300">"${r.reason}"</p>
                        </div>` + container.innerHTML;
                });
            });
        }

        function openQR(id) {
            db.ref('assets/' + id).once('value', snap => {
                const a = snap.val();
                const m = document.createElement('div');
                m.className = "fixed inset-0 z-[3000] bg-black/95 flex items-center justify-center p-6";
                m.innerHTML = `
                    <div class="glass-card p-8 text-center" id="print-area">
                        <div id="qr-gen" class="bg-white p-4 rounded-2xl mb-4 inline-block"></div>
                        <h4 id="qr-label" class="text-white font-black uppercase text-sm mb-4">${a.name}</h4>
                        <div class="flex flex-col gap-2 w-full no-print">
                            <button onclick="window.print()" class="w-full bg-emerald-600 hover:bg-emerald-500 p-3 rounded-xl font-black uppercase text-xs transition">
                                <i class="fas fa-print mr-2"></i>Imprimir QR
                            </button>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="w-full btn-primary p-3 rounded-xl font-black uppercase text-xs">
                                Cerrar
                            </button>
                        </div>
                    </div>`;
                document.body.appendChild(m);
                new QRCode(document.getElementById('qr-gen'), { 
                    text: "https://anniel137.github.io/uptjaa-inventory/?id=" + id, 
                    width: 220, 
                    height: 220 
                });
            });
        }

        function deleteAsset(id) { if(confirm("¿Seguro que desea eliminar este activo tecnológico?")) db.ref('assets/' + id).remove(); }
        function deleteUser(id) { if(confirm("¿Eliminar acceso a este usuario?")) db.ref('users/' + id).remove(); }
        
        document.getElementById('login-form').onsubmit = (e) => {
            e.preventDefault();
            auth.signInWithEmailAndPassword(document.getElementById('user-input').value, document.getElementById('pass-input').value).catch(() => alert("Acceso denegado. Verifique sus credenciales."));
        };
        function logout() { auth.signOut().then(() => location.href = window.location.origin + window.location.pathname); }
    </script>
</body>
</html>
